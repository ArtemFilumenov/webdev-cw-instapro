(()=>{"use strict";var e={d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{dg:()=>U,ri:()=>I,MY:()=>C,Yl:()=>O,kQ:()=>q});const t="https://webdev-hw-api.vercel.app",n=`${t}/api/v1/:artem-filumenov/instapro`,a=()=>q?`Bearer ${q.token}`:void 0;function r(e){return fetch(n+"/"+e+"/like",{method:"POST",headers:{Authorization:a()}}).then((e=>{if(500===e.status)throw new Error("Сервер упал");if(400===e.status)throw new Error("Короткие вводимые данные");return e.json()}))}function o(e){return fetch(n+"/"+e+"/dislike",{method:"POST",headers:{Authorization:a()}}).then((e=>{if(500===e.status)throw new Error("Сервер упал");if(400===e.status)throw new Error("Короткие вводимые данные");return e.json()}))}const i="posts",s="user-posts",l="auth",u="add-post",d="loading";function c({element:e}){return e.innerHTML=`\n  <div class="page-header">\n      <h1 class="logo">instapro</h1>\n      <button class="header-button add-or-login-button">\n      ${q?'<div title="Добавить пост" class="add-post-sign"></div>':"Войти"}\n      </button>\n      ${q?`<button title="${q.name}" class="header-button logout-button">Выйти</button>`:""}  \n  </div>\n  \n`,e.querySelector(".add-or-login-button").addEventListener("click",(()=>{U(q?u:l)})),e.querySelector(".logo").addEventListener("click",(()=>{U(i)})),e.querySelector(".logout-button")?.addEventListener("click",I),e}function m({element:e,onImageUrlChange:n}){let a="";const r=()=>{e.innerHTML=`\n  <div class="upload=image">\n      ${a?`\n          <div class="file-upload-image-conrainer">\n            <img class="file-upload-image" src="${a}">\n            <button class="file-upload-remove-button button">Заменить фото</button>\n          </div>\n          `:'\n            <label class="file-upload-label secondary-button">\n                <input\n                  type="file"\n                  class="file-upload-input"\n                  style="display:none"\n                />\n                Выберите фото\n            </label>\n          \n      '}\n  </div>\n`;const o=e.querySelector(".file-upload-input");o?.addEventListener("change",(()=>{const e=o.files[0];if(e){const o=document.querySelector(".file-upload-label");o.setAttribute("disabled",!0),o.textContent="Загружаю файл...",function({file:e}){const n=new FormData;return n.append("file",e),fetch(t+"/api/upload/image",{method:"POST",body:n}).then((e=>e.json()))}({file:e}).then((({fileUrl:e})=>{a=e,n(a),r()}))}})),e.querySelector(".file-upload-remove-button")?.addEventListener("click",(()=>{a="",n(a),r()}))};r()}function h(e){return function(e,t){return e instanceof Date?new e.constructor(t):new Date(t)}(e,Date.now())}function f(e){const t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new e.constructor(+e):"number"==typeof e||"[object Number]"===t||"string"==typeof e||"[object String]"===t?new Date(e):new Date(NaN)}function g(e,t){const n=f(e),a=f(t),r=n.getTime()-a.getTime();return r<0?-1:r>0?1:r}Math.pow(10,8);const p=43200,v=1440;function b(e){const t=f(e);return+function(e){const t=f(e);return t.setHours(23,59,59,999),t}(t)==+function(e){const t=f(e),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(23,59,59,999),t}(t)}function y(e,t){const n=f(e),a=f(t),r=g(n,a),o=Math.abs(function(e,t){const n=f(e),a=f(t);return 12*(n.getFullYear()-a.getFullYear())+(n.getMonth()-a.getMonth())}(n,a));let i;if(o<1)i=0;else{1===n.getMonth()&&n.getDate()>27&&n.setDate(30),n.setMonth(n.getMonth()-r*o);let t=g(n,a)===-r;b(f(e))&&1===o&&1===g(e,a)&&(t=!1),i=r*(o-Number(t))}return 0===i?0:i}function w(e,t,n){const a=function(e,t){return+f(e)-+f(t)}(e,t)/1e3;return(r=n?.roundingMethod,e=>{const t=(r?Math[r]:Math.trunc)(e);return 0===t?0:t})(a);var r}const M={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function S(e){return(t={})=>{const n=t.width?String(t.width):e.defaultWidth;return e.formats[n]||e.formats[e.defaultWidth]}}const k={date:S({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:S({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:S({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},E={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function P(e){return(t,n)=>{let a;if("formatting"===(n?.context?String(n.context):"standalone")&&e.formattingValues){const t=e.defaultFormattingWidth||e.defaultWidth,r=n?.width?String(n.width):t;a=e.formattingValues[r]||e.formattingValues[t]}else{const t=e.defaultWidth,r=n?.width?String(n.width):e.defaultWidth;a=e.values[r]||e.values[t]}return a[e.argumentCallback?e.argumentCallback(t):t]}}function D(e){return(t,n={})=>{const a=n.width,r=a&&e.matchPatterns[a]||e.matchPatterns[e.defaultMatchWidth],o=t.match(r);if(!o)return null;const i=o[0],s=a&&e.parsePatterns[a]||e.parsePatterns[e.defaultParseWidth],l=Array.isArray(s)?function(e,t){for(let t=0;t<e.length;t++)if(e[t].test(i))return t}(s):function(e,t){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&e[t].test(i))return t}(s);let u;return u=e.valueCallback?e.valueCallback(l):l,u=n.valueCallback?n.valueCallback(u):u,{value:u,rest:t.slice(i.length)}}}var A;const T={code:"en-US",formatDistance:(e,t,n)=>{let a;const r=M[e];return a="string"==typeof r?r:1===t?r.one:r.other.replace("{{count}}",t.toString()),n?.addSuffix?n.comparison&&n.comparison>0?"in "+a:a+" ago":a},formatLong:k,formatRelative:(e,t,n,a)=>E[e],localize:{ordinalNumber:(e,t)=>{const n=Number(e),a=n%100;if(a>20||a<10)switch(a%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:P({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:P({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:P({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:P({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:P({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:(A={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)},(e,t={})=>{const n=e.match(A.matchPattern);if(!n)return null;const a=n[0],r=e.match(A.parsePattern);if(!r)return null;let o=A.valueCallback?A.valueCallback(r[0]):r[0];return o=t.valueCallback?t.valueCallback(o):o,{value:o,rest:e.slice(a.length)}}),era:D({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:D({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:D({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:D({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:D({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}};let W={};function j(){return W}function x(e){const t=f(e),n=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return n.setUTCFullYear(t.getFullYear()),+e-+n}function $(e,t){return function(e,t,n){const a=j(),r=n?.locale??a.locale??T,o=g(e,t);if(isNaN(o))throw new RangeError("Invalid time value");const i=Object.assign({},n,{addSuffix:n?.addSuffix,comparison:o});let s,l;o>0?(s=f(t),l=f(e)):(s=f(e),l=f(t));const u=w(l,s),d=(x(l)-x(s))/1e3,c=Math.round((u-d)/60);let m;if(c<2)return n?.includeSeconds?u<5?r.formatDistance("lessThanXSeconds",5,i):u<10?r.formatDistance("lessThanXSeconds",10,i):u<20?r.formatDistance("lessThanXSeconds",20,i):u<40?r.formatDistance("halfAMinute",0,i):u<60?r.formatDistance("lessThanXMinutes",1,i):r.formatDistance("xMinutes",1,i):0===c?r.formatDistance("lessThanXMinutes",1,i):r.formatDistance("xMinutes",c,i);if(c<45)return r.formatDistance("xMinutes",c,i);if(c<90)return r.formatDistance("aboutXHours",1,i);if(c<v){const e=Math.round(c/60);return r.formatDistance("aboutXHours",e,i)}if(c<2520)return r.formatDistance("xDays",1,i);if(c<p){const e=Math.round(c/v);return r.formatDistance("xDays",e,i)}if(c<2*p)return m=Math.round(c/p),r.formatDistance("aboutXMonths",m,i);if(m=y(l,s),m<12){const e=Math.round(c/p);return r.formatDistance("xMonths",e,i)}{const e=m%12,t=Math.trunc(m/12);return e<3?r.formatDistance("aboutXYears",t,i):e<9?r.formatDistance("overXYears",t,i):r.formatDistance("almostXYears",t+1,i)}}(e,h(e),t)}let q=function(e){try{return JSON.parse(window.localStorage.getItem("user"))}catch(e){return null}}(),C=null,O=[];const I=()=>{q=null,window.localStorage.removeItem("user"),U(i)},U=(e,t)=>{if([i,l,u,s,d].includes(e))return e===u?(C=q?u:l,L()):e===i?(C=d,L(),fetch(n,{method:"GET",headers:{Authorization:a()}}).then((e=>{if(401===e.status)throw new Error("Нет авторизации");return e.json()})).then((e=>e.posts)).then((e=>{C=i,O=e,L()})).catch((e=>{console.error(e),U(i)}))):e===s?(C=d,L(),function(e){return fetch(n+"/user-posts/"+e,{method:"GET",headers:{Authorization:a()}}).then((e=>{if(401===e.status)throw new Error("Нет авторизации");return e.json()})).then((e=>e.posts))}(t).then((e=>{C=s,O=e,L()})).catch((e=>{console.error(e),U(i)}))):(C=e,void L());throw new Error("страницы не существует")},L=()=>{const e=document.getElementById("app");return C===d?function({appEl:e,user:t,goToPage:n}){e.innerHTML='\n              <div class="page-container">\n                <div class="header-container"></div>\n                <div class="loading-page">\n                  <div class="loader"><div></div><div></div><div></div></div>\n                </div>\n              </div>',c({user:t,element:document.querySelector(".header-container"),goToPage:n})}({appEl:e,user:q,goToPage:U}):C===l?function({appEl:e,setUser:n}){let a=!0,r="";const o=()=>{const i=`\n      <div class="page-container">\n          <div class="header-container"></div>\n          <div class="form">\n              <h3 class="form-title">\n                ${a?"Вход в&nbsp;Instapro":"Регистрация в&nbsp;Instapro"}\n                </h3>\n              <div class="form-inputs">\n    \n                  ${a?"":'\n                      <div class="upload-image-container"></div>\n                      <input type="text" id="name-input" class="input" placeholder="Имя" />\n                      '}\n                  \n                  <input type="text" id="login-input" class="input" placeholder="Логин" />\n                  <input type="password" id="password-input" class="input" placeholder="Пароль" />\n                  \n                  <div class="form-error"></div>\n                  \n                  <button class="button" id="login-button">${a?"Войти":"Зарегистрироваться"}</button>\n              </div>\n            \n              <div class="form-footer">\n                <p class="form-footer-title">\n                  ${a?"Нет аккаунта?":"Уже есть аккаунт?"}\n                  <button class="link-button" id="toggle-button">\n                    ${a?"Зарегистрироваться.":"Войти."}\n                  </button>\n                </p> \n               \n              </div>\n          </div>\n      </div>    \n`;e.innerHTML=i;const s=t=>{e.querySelector(".form-error").textContent=t};c({element:document.querySelector(".header-container")}),e.querySelector(".upload-image-container")&&m({element:e.querySelector(".upload-image-container"),onImageUrlChange(e){r=e}}),document.getElementById("login-button").addEventListener("click",(()=>{if(s(""),a){const e=document.getElementById("login-input").value,a=document.getElementById("password-input").value;if(!e)return void alert("Введите логин");if(!a)return void alert("Введите пароль");(function({login:e,password:n}){return fetch(t+"/api/user/login",{method:"POST",body:JSON.stringify({login:e.replaceAll("<","&lt;").replaceAll(">","&gt;"),password:n.replaceAll("<","&lt;").replaceAll(">","&gt;")})}).then((e=>{if(400===e.status)throw new Error("Неверный логин или пароль");return e.json()}))})({login:e,password:a}).then((e=>{n(e.user)})).catch((e=>{console.warn(e),s(e.message)}))}else{const e=document.getElementById("login-input").value,a=document.getElementById("name-input").value,o=document.getElementById("password-input").value;if(!a)return void alert("Введите имя");if(!e)return void alert("Введите логин");if(!o)return void alert("Введите пароль");if(!r)return void alert("Не выбрана фотография");(function({login:e,password:n,name:a,imageUrl:r}){return fetch(t+"/api/user",{method:"POST",body:JSON.stringify({login:e.replaceAll("<","&lt;").replaceAll(">","&gt;"),password:n.replaceAll("<","&lt;").replaceAll(">","&gt;"),name:a.replaceAll("<","&lt;").replaceAll(">","&gt;"),imageUrl:r})}).then((e=>{if(400===e.status)throw new Error("Такой пользователь уже существует");return e.json()}))})({login:e,password:o,name:a,imageUrl:r}).then((e=>{n(e.user)})).catch((e=>{console.warn(e),s(e.message)}))}})),document.getElementById("toggle-button").addEventListener("click",(()=>{a=!a,o()}))};o()}({appEl:e,setUser:e=>{q=e,function(e){window.localStorage.setItem("user",JSON.stringify(e))}(q),U(i)},user:q,goToPage:U}):C===u?function({appEl:e,onAddPostClick:t}){(()=>{let n="";e.innerHTML='\n    <div class="page-container">\n      <div class="header-container"></div>\n      <div class="form">\n        <h3 class="form-title">Добавить пост</h3>\n        <div class="form-inputs">\n          <div class="upload-image-container">\n          </div>\n        </div>\n        <p>Опишите фотографию:</p>\n        <textarea type="textarea" class="add-text" id="description"></textarea>\n        <button class="button" id="add-button">Добавить</button>\n      </div>\n    </div>',c({element:document.querySelector(".header-container")}),e.querySelector(".upload-image-container")&&m({element:e.querySelector(".upload-image-container"),onImageUrlChange(e){n=e}}),document.getElementById("add-button").addEventListener("click",(()=>{const e=document.getElementById("description");t({description:e.value,imageUrl:n})}))})()}({appEl:e,onAddPostClick({description:e,imageUrl:t}){U(d),function({description:e,imageUrl:t}){return fetch(n,{method:"POST",body:JSON.stringify({description:e.replaceAll("<","&lt;").replaceAll(">","&gt;"),imageUrl:t}),headers:{Authorization:a()}}).then((e=>{if(500===e.status)throw new Error("Сервер упал");if(400===e.status)throw new Error("Короткие вводимые данные");return e.json()}))}({description:e,imageUrl:t}).then((()=>{U(i)})).catch((e=>{console.log(e),U(u),alert(e.message)}))}}):C===i||C===s?function({appEl:e}){console.log("Актуальный список постов:",O);const t=O.map((e=>`                 <li class="post">\n    ${C===i?`<div class="post-header" data-userid="${e.user.id}">\n    <img src="${e.user.imageUrl}" class="post-header__user-image">\n    <p class="post-header__user-name">${e.user.name}</p>\n</div>`:""} \n    <div class="post-image-container">\n      <img class="post-image" src="${e.imageUrl}">\n    </div>\n    <div class="post-likes">\n      <button data-id="${e.id}" class="like-button">\n        ${e.isLiked?'<img src="./assets/images/like-active.svg">':'<img src="./assets/images/like-not-active.svg">'}\n      </button>\n      <p class="post-likes-text">\n        Нравится: <strong>${e.likes.length}</strong>\n      </p>\n    </div>\n    <p class="post-text">\n      <span class="user-name">${e.user.name}</span>\n      ${e.description}\n    </p>\n    <p class="post-date">\n      ${$(new Date(e.createdAt),{addSuffix:!0})}\n    </p>\n  </li>\n  `)).join(""),n=`\n              <div class="page-container">\n                <div class="header-container"></div>\n                ${C===s?`<div class="posts-user-header" data-userid="${O[0]?.user.id}">\n                <img src="${O[0]?.user.imageUrl}" class="posts-user-header__user-image">\n                <p class="posts-user-header__user-name">${O[0]?.user.name}</p>\n            </div>`:""} <ul class="posts">\n                  ${t}\n                </ul>\n              </div>`;e.innerHTML=n,c({element:document.querySelector(".header-container")});for(let e of document.querySelectorAll(".post-header"))e.addEventListener("click",(()=>{const t=e.dataset.userid;console.log(t),U(s,t)}));q&&function(){const e=document.querySelectorAll(".like-button");for(const t of e)t.addEventListener("click",(()=>{const e=t.dataset.id;O.find((t=>t.id===e)).isLiked?o(e).then((()=>{U(i)})):r(e).then((()=>{U(i)}))}))}()}({appEl:e}):void 0};U(i)})();